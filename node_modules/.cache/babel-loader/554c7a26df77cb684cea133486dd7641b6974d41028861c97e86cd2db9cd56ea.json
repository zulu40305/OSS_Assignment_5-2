{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.useIntersection = useIntersection;\nvar _react = require(\"react\");\nvar _requestIdleCallback = require(\"./request-idle-callback\");\nconst hasIntersectionObserver = typeof IntersectionObserver === 'function';\nconst observers = new Map();\nconst idList = [];\nfunction createObserver(options) {\n  const id = {\n    root: options.root || null,\n    margin: options.rootMargin || ''\n  };\n  const existing = idList.find(obj => obj.root === id.root && obj.margin === id.margin);\n  let instance;\n  if (existing) {\n    instance = observers.get(existing);\n    if (instance) {\n      return instance;\n    }\n  }\n  const elements = new Map();\n  const observer = new IntersectionObserver(entries => {\n    entries.forEach(entry => {\n      const callback = elements.get(entry.target);\n      const isVisible = entry.isIntersecting || entry.intersectionRatio > 0;\n      if (callback && isVisible) {\n        callback(isVisible);\n      }\n    });\n  }, options);\n  instance = {\n    id,\n    observer,\n    elements\n  };\n  idList.push(id);\n  observers.set(id, instance);\n  return instance;\n}\nfunction observe(element, callback, options) {\n  const {\n    id,\n    observer,\n    elements\n  } = createObserver(options);\n  elements.set(element, callback);\n  observer.observe(element);\n  return function unobserve() {\n    elements.delete(element);\n    observer.unobserve(element);\n    // Destroy observer when there's nothing left to watch:\n    if (elements.size === 0) {\n      observer.disconnect();\n      observers.delete(id);\n      const index = idList.findIndex(obj => obj.root === id.root && obj.margin === id.margin);\n      if (index > -1) {\n        idList.splice(index, 1);\n      }\n    }\n  };\n}\nfunction useIntersection({\n  rootRef,\n  rootMargin,\n  disabled\n}) {\n  const isDisabled = disabled || !hasIntersectionObserver;\n  const [visible, setVisible] = (0, _react).useState(false);\n  const [element, setElement] = (0, _react).useState(null);\n  (0, _react).useEffect(() => {\n    if (hasIntersectionObserver) {\n      if (isDisabled || visible) return;\n      if (element && element.tagName) {\n        const unobserve = observe(element, isVisible => isVisible && setVisible(isVisible), {\n          root: rootRef == null ? void 0 : rootRef.current,\n          rootMargin\n        });\n        return unobserve;\n      }\n    } else {\n      if (!visible) {\n        const idleCallback = (0, _requestIdleCallback).requestIdleCallback(() => setVisible(true));\n        return () => (0, _requestIdleCallback).cancelIdleCallback(idleCallback);\n      }\n    }\n  }, [element, isDisabled, rootMargin, rootRef, visible]);\n  const resetVisible = (0, _react).useCallback(() => {\n    setVisible(false);\n  }, []);\n  return [setElement, visible, resetVisible];\n}\nif ((typeof exports.default === 'function' || typeof exports.default === 'object' && exports.default !== null) && typeof exports.default.__esModule === 'undefined') {\n  Object.defineProperty(exports.default, '__esModule', {\n    value: true\n  });\n  Object.assign(exports.default, exports);\n  module.exports = exports.default;\n}","map":{"version":3,"names":["useIntersection","_react","require","_requestIdleCallback","hasIntersectionObserver","IntersectionObserver","observers","Map","idList","createObserver","options","id","root","margin","rootMargin","existing","find","obj","instance","get","elements","observer","entries","forEach","entry","callback","target","isVisible","isIntersecting","intersectionRatio","push","set","observe","element","unobserve","delete","size","disconnect","index","findIndex","splice","rootRef","disabled","isDisabled","visible","setVisible","useState","setElement","useEffect","tagName","current","idleCallback","requestIdleCallback","cancelIdleCallback","resetVisible","useCallback"],"sources":["../../client/use-intersection.tsx"],"sourcesContent":[null],"mappings":"AAAA;;;;;QA+FgBA,eAAe,GAAfA,eAAe;AA/FkB,IAAAC,MAAO,GAAAC,OAAA,CAAP,OAAO;AAIjD,IAAAC,oBAAyB,GAAAD,OAAA,CAAzB,yBAAyB;AAqBhC,MAAME,uBAAuB,GAAG,OAAOC,oBAAoB,KAAK,UAAU;AAE1E,MAAMC,SAAS,GAAG,IAAIC,GAAG,EAAwB;AACjD,MAAMC,MAAM,GAAiB,EAAE;AAE/B,SAASC,cAAcA,CAACC,OAAoC,EAAY;EACtE,MAAMC,EAAE,GAAG;IACTC,IAAI,EAAEF,OAAO,CAACE,IAAI,IAAI,IAAI;IAC1BC,MAAM,EAAEH,OAAO,CAACI,UAAU,IAAI;GAC/B;EACD,MAAMC,QAAQ,GAAGP,MAAM,CAACQ,IAAI,CACzBC,GAAG,IAAKA,GAAG,CAACL,IAAI,KAAKD,EAAE,CAACC,IAAI,IAAIK,GAAG,CAACJ,MAAM,KAAKF,EAAE,CAACE,MAAM,CAC1D;EACD,IAAIK,QAAQ;EAEZ,IAAIH,QAAQ,EAAE;IACZG,QAAQ,GAAGZ,SAAS,CAACa,GAAG,CAACJ,QAAQ,CAAC;IAClC,IAAIG,QAAQ,EAAE;MACZ,OAAOA,QAAQ;;;EAInB,MAAME,QAAQ,GAAG,IAAIb,GAAG,EAA4B;EACpD,MAAMc,QAAQ,GAAG,IAAIhB,oBAAoB,CAAEiB,OAAO,IAAK;IACrDA,OAAO,CAACC,OAAO,CAAEC,KAAK,IAAK;MACzB,MAAMC,QAAQ,GAAGL,QAAQ,CAACD,GAAG,CAACK,KAAK,CAACE,MAAM,CAAC;MAC3C,MAAMC,SAAS,GAAGH,KAAK,CAACI,cAAc,IAAIJ,KAAK,CAACK,iBAAiB,GAAG,CAAC;MACrE,IAAIJ,QAAQ,IAAIE,SAAS,EAAE;QACzBF,QAAQ,CAACE,SAAS,CAAC;;KAEtB,CAAC;GACH,EAAEjB,OAAO,CAAC;EACXQ,QAAQ,GAAG;IACTP,EAAE;IACFU,QAAQ;IACRD;GACD;EAEDZ,MAAM,CAACsB,IAAI,CAACnB,EAAE,CAAC;EACfL,SAAS,CAACyB,GAAG,CAACpB,EAAE,EAAEO,QAAQ,CAAC;EAC3B,OAAOA,QAAQ;;AAGjB,SAASc,OAAOA,CACdC,OAAgB,EAChBR,QAAyB,EACzBf,OAAoC,EACxB;EACZ,MAAM;IAAEC,EAAE;IAAEU,QAAQ;IAAED;EAAQ,CAAE,GAAGX,cAAc,CAACC,OAAO,CAAC;EAC1DU,QAAQ,CAACW,GAAG,CAACE,OAAO,EAAER,QAAQ,CAAC;EAE/BJ,QAAQ,CAACW,OAAO,CAACC,OAAO,CAAC;EACzB,OAAO,SAASC,SAASA,CAAA,EAAS;IAChCd,QAAQ,CAACe,MAAM,CAACF,OAAO,CAAC;IACxBZ,QAAQ,CAACa,SAAS,CAACD,OAAO,CAAC;IAE3B;IACA,IAAIb,QAAQ,CAACgB,IAAI,KAAK,CAAC,EAAE;MACvBf,QAAQ,CAACgB,UAAU,EAAE;MACrB/B,SAAS,CAAC6B,MAAM,CAACxB,EAAE,CAAC;MACpB,MAAM2B,KAAK,GAAG9B,MAAM,CAAC+B,SAAS,CAC3BtB,GAAG,IAAKA,GAAG,CAACL,IAAI,KAAKD,EAAE,CAACC,IAAI,IAAIK,GAAG,CAACJ,MAAM,KAAKF,EAAE,CAACE,MAAM,CAC1D;MACD,IAAIyB,KAAK,GAAG,CAAC,CAAC,EAAE;QACd9B,MAAM,CAACgC,MAAM,CAACF,KAAK,EAAE,CAAC,CAAC;;;GAG5B;;AAGI,SAAStC,eAAeA,CAAoB;EACjDyC,OAAO;EACP3B,UAAU;EACV4B;AAAQ,CACQ,EAAsD;EACtE,MAAMC,UAAU,GAAYD,QAAQ,IAAI,CAACtC,uBAAuB;EAEhE,MAAM,CAACwC,OAAO,EAAEC,UAAU,CAAC,GAAG,IAAA5C,MAAQ,EAAO6C,QAAP,CAAC,KAAK,CAAC;EAC7C,MAAM,CAACb,OAAO,EAAEc,UAAU,CAAC,GAAG,IAAA9C,MAAQ,EAAgB6C,QAAhB,CAAW,IAAI,CAAC;EAEtD,IAAA7C,MAAS,EAmB8C+C,SAnB9C,CAAC,MAAM;IACd,IAAI5C,uBAAuB,EAAE;MAC3B,IAAIuC,UAAU,IAAIC,OAAO,EAAE;MAE3B,IAAIX,OAAO,IAAIA,OAAO,CAACgB,OAAO,EAAE;QAC9B,MAAMf,SAAS,GAAGF,OAAO,CACvBC,OAAO,EACNN,SAAS,IAAKA,SAAS,IAAIkB,UAAU,CAAClB,SAAS,CAAC,EACjD;UAAEf,IAAI,EAAE6B,OAAO,QAAS,GAAhB,MAAgB,GAAhBA,OAAO,CAAES,OAAO;UAAEpC;SAAY,CACvC;QAED,OAAOoB,SAAS;;KAEnB,MAAM;MACL,IAAI,CAACU,OAAO,EAAE;QACZ,MAAMO,YAAY,GAAG,IAAAhD,oBAAmB,EAAwBiD,mBAAxB,CAAC,MAAMP,UAAU,CAAC,IAAI,CAAC,CAAC;QAChE,OAAO,MAAM,IAAA1C,oBAAkB,EAAckD,kBAAd,CAACF,YAAY,CAAC;;;GAGlD,EAAE,CAAClB,OAAO,EAAEU,UAAU,EAAE7B,UAAU,EAAE2B,OAAO,EAAEG,OAAO,CAAC,CAAC;EAEvD,MAAMU,YAAY,GAAG,IAAArD,MAAW,EAE1BsD,WAF0B,CAAC,MAAM;IACrCV,UAAU,CAAC,KAAK,CAAC;GAClB,EAAE,EAAE,CAAC;EAEN,OAAO,CAACE,UAAU,EAAEH,OAAO,EAAEU,YAAY,CAAC","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}